<!DOCTYPE html>
<html>
<head>
  <title>HTML5 Geolocation Demo</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<style>
p {
  margin: 0 0 0.3em 0;
}
</style>
</head>
<body>
  <h2>This is a demonstration of the native HTML5 Geolocation API.</h2>
  <p>Result: <span id="result">xx</span></p>
  <p>Latitude: <span id="latitude">xx</span></p>
  <p>Longitude: <span id="longitude">xx</span></p>
  <p>Altitude: <span id="altitude">xx</span></p>
  <p>Accuracy: <span id="accuracy">xx</span></p>
  <p>Altitude Accuracy: <span id="altitude-accuracy">xx</span></p>
  <p>Heading: <span id="heading">xx</span></p>
  <p>Speed: <span id="speed">xx</span></p>
  <p>
    <input type="checkbox" id="high-accuracy"/>
    <label for="high-accuracy">Enable high accuracy</label>
    </p>
  <p>
    <input type="checkbox" id="watch-position"/>
    <label for="watch-position">Refresh every:</label>
    <input type="text" id="refresh-timeout" value="1000">
    </p>
  <input type="button" id="geolocate" value="Geolocate"/>
<script>
  var highAccuracy = false;
  var watchTimeout = 0;
  var watchId;
  var geo;
  geo = navigator.geolocation;
  
  function clearResults() {
    $('#result').html('--');
    $('#latitude').html('--');
    $('#longitude').html('--');
    $('#altitude').html('--');
    $('#accuracy').html('--');
    $('#altitude-accuracy').html('--');
    $('#heading').html('--');
    $('#speed').html('--');
  }

  var successCallback = function(position) {
    console.log('Got position at ' + position.timestamp);
    $('#result').html('SUCCESS');
    $('#latitude').html(position.coords.latitude);
    $('#longitude').html(position.coords.longitude);
    $('#altitude').html(position.coords.altitude);
    $('#accuracy').html(position.coords.accuracy);
    $('#altitude-accuracy').html(position.coords.altitudeAccuracy);
    $('#heading').html(position.coords.heading);
    $('#speed').html(position.coords.speed);
  };
  
  var errorCallback = function(error) {
    $('#result').html(error.message);
  }
  
  function getPosition() {
    console.log('About to get position');
    geo.getCurrentPosition(successCallback, 
                           errorCallback, 
                           { 
                             enableHighAccuracy: highAccuracy 
                           });
  }
  
  function watchPosition() {
    console.log('About to watch position every ' + watchTimeout);
    watchId = geo.watchPosition(successCallback, 
                                errorCallback, 
                                { 
                                  timeout: watchTimeout, 
                                  enableHighAccuracy: highAccuracy 
                                });
  }
  
  $(document).ready(function() {
    $('#geolocate').click(function(event) { 
      clearResults();
      
      highAccuracy = $('#high-accuracy:checked').length == 1;
      
      if($('#watch-position:checked').length == 1) {
        watchTimeout = parseInt($('#refresh-timeout').val());
      }
      else {
        watchTimeout = 0;
      }

      if(watchId) {
        console.log('Clearing watchId ' + watchId)
        geo.clearWatch(watchId);
        watchId = 0;
      }

      if(watchTimeout) {
        watchPosition();
      }
      else {
        getPosition();
      }
    });
  });
</script>
</body>